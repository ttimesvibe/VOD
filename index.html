<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VOD ì‹ ì²­</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #FAFBFC;
      --surface: #FFFFFF;
      --surface-hover: #F7F8FA;
      --border: #E2E6EB;
      --border-focus: #3B82F6;
      --text-primary: #1A1D23;
      --text-secondary: #5F6774;
      --text-tertiary: #9CA3AF;
      --accent: #3B82F6;
      --accent-hover: #2563EB;
      --accent-light: #EFF6FF;
      --accent-soft: #DBEAFE;
      --success: #10B981;
      --success-light: #ECFDF5;
      --error: #EF4444;
      --error-light: #FEF2F2;
      --warning: #F59E0B;
      --warning-light: #FFFBEB;
      --radius: 12px;
      --radius-sm: 8px;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
      --shadow-lg: 0 8px 30px rgba(0,0,0,0.12);
      --font-ko: 'Noto Sans KR', sans-serif;
      --font-en: 'Outfit', sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--font-ko);
      background: var(--bg);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      -webkit-font-smoothing: antialiased;
    }

    /* === PROGRESS BAR === */
    .progress-bar {
      display: flex;
      align-items: center;
      gap: 0;
      margin-bottom: 32px;
      width: 100%;
      max-width: 480px;
    }

    .progress-step {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-family: var(--font-en);
      font-size: 13px;
      font-weight: 600;
      background: var(--border);
      color: var(--text-tertiary);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      flex-shrink: 0;
    }

    .progress-step.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 0 0 4px var(--accent-soft);
    }

    .progress-step.done {
      background: var(--success);
      color: white;
    }

    .progress-line {
      flex: 1;
      height: 2px;
      background: var(--border);
      transition: background 0.4s ease;
    }

    .progress-line.done {
      background: var(--success);
    }

    /* === CARD === */
    .card {
      background: var(--surface);
      border-radius: 16px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-md);
      padding: 40px;
      width: 100%;
      max-width: 480px;
      animation: cardIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes cardIn {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-primary);
      letter-spacing: -0.3px;
    }

    .card-desc {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 28px;
    }

    /* === FORM ELEMENTS === */
    .input-group {
      margin-bottom: 20px;
    }

    .input-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .input-field {
      width: 100%;
      padding: 14px 16px;
      border: 1.5px solid var(--border);
      border-radius: var(--radius-sm);
      font-family: var(--font-ko);
      font-size: 15px;
      color: var(--text-primary);
      background: var(--surface);
      transition: all 0.2s ease;
      outline: none;
    }

    .input-field:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .input-field::placeholder {
      color: var(--text-tertiary);
    }

    .input-field.error {
      border-color: var(--error);
      box-shadow: 0 0 0 3px rgba(239,68,68,0.1);
    }

    .code-input-group {
      display: flex;
      gap: 8px;
    }

    .code-input {
      flex: 1;
      text-align: center;
      font-family: var(--font-en);
      font-size: 24px;
      font-weight: 600;
      letter-spacing: 8px;
      padding: 14px 16px;
    }

    /* === BUTTONS === */
    .btn {
      width: 100%;
      padding: 14px 24px;
      border: none;
      border-radius: var(--radius-sm);
      font-family: var(--font-ko);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--accent-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-ghost {
      background: transparent;
      color: var(--accent);
      padding: 8px;
      font-size: 13px;
    }

    .btn-ghost:hover {
      background: var(--accent-light);
    }

    .btn .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* === RADIO OPTIONS === */
    .option-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }

    .option-card {
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      padding: 18px 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: flex-start;
      gap: 14px;
    }

    .option-card:hover {
      border-color: var(--accent);
      background: var(--accent-light);
    }

    .option-card.selected {
      border-color: var(--accent);
      background: var(--accent-light);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .option-radio {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 1px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .option-card.selected .option-radio {
      border-color: var(--accent);
    }

    .option-card.selected .option-radio::after {
      content: '';
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
    }

    .option-info h4 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .option-info p {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .option-icon {
      font-size: 22px;
      flex-shrink: 0;
    }

    /* === NOTICE BOX (admin-editable) === */
    .notice-box {
      background: var(--warning-light);
      border: 1px solid #FDE68A;
      border-radius: var(--radius-sm);
      padding: 18px 20px;
      margin-bottom: 24px;
    }

    .notice-box .notice-title {
      font-size: 14px;
      font-weight: 700;
      color: #92400E;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .notice-box .notice-content {
      font-size: 13px;
      color: #78350F;
      line-height: 1.7;
    }

    .notice-box .notice-content h4 {
      font-size: 13px;
      font-weight: 700;
      margin-top: 12px;
      margin-bottom: 4px;
    }

    .notice-box .notice-content ul {
      padding-left: 18px;
      margin: 4px 0;
    }

    .notice-box .notice-content li {
      margin-bottom: 2px;
    }

    /* === MESSAGES === */
    .msg {
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 16px;
      display: none;
    }

    .msg.show { display: block; animation: msgIn 0.3s ease; }

    @keyframes msgIn {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .msg-error {
      background: var(--error-light);
      color: #991B1B;
      border: 1px solid #FECACA;
    }

    .msg-success {
      background: var(--success-light);
      color: #065F46;
      border: 1px solid #A7F3D0;
    }

    .msg-info {
      background: var(--accent-light);
      color: #1E40AF;
      border: 1px solid var(--accent-soft);
    }

    /* === COMPLETE SCREEN === */
    .complete-icon {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background: var(--success-light);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    .complete-icon svg {
      width: 36px;
      height: 36px;
      color: var(--success);
    }

    .complete-title {
      text-align: center;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .complete-desc {
      text-align: center;
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.7;
    }

    .summary-box {
      background: var(--bg);
      border-radius: var(--radius-sm);
      padding: 18px 20px;
      margin-top: 24px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 14px;
    }

    .summary-row + .summary-row {
      border-top: 1px solid var(--border);
    }

    .summary-label {
      color: var(--text-secondary);
    }

    .summary-value {
      font-weight: 600;
      color: var(--text-primary);
    }

    /* === COUNTDOWN === */
    .countdown {
      font-size: 12px;
      color: var(--text-tertiary);
      text-align: center;
      margin-top: 12px;
      font-family: var(--font-en);
    }

    /* === HEADER === */
    .page-header {
      text-align: center;
      margin-bottom: 36px;
      max-width: 480px;
      width: 100%;
    }

    .page-header .logo {
      font-family: var(--font-en);
      font-size: 14px;
      font-weight: 600;
      color: var(--text-tertiary);
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 12px;
    }

    .page-header h1 {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.5px;
      color: var(--text-primary);
    }

    /* === FOOTER === */
    .page-footer {
      margin-top: 40px;
      font-size: 12px;
      color: var(--text-tertiary);
      text-align: center;
    }

    /* === HIDDEN === */
    .hidden { display: none !important; }

    /* === RESPONSIVE === */
    @media (max-width: 520px) {
      body { padding: 24px 16px; }
      .card { padding: 28px 24px; }
      .card-title { font-size: 20px; }
      .page-header h1 { font-size: 24px; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="page-header">
    <div class="logo">VOD Service</div>
    <h1>VOD ì‹œì²­ ì‹ ì²­</h1>
  </div>

  <!-- PROGRESS BAR -->
  <div class="progress-bar" id="progressBar">
    <div class="progress-step active" id="ps1">1</div>
    <div class="progress-line" id="pl1"></div>
    <div class="progress-step" id="ps2">2</div>
    <div class="progress-line" id="pl2"></div>
    <div class="progress-step" id="ps3">3</div>
    <div class="progress-line" id="pl3"></div>
    <div class="progress-step" id="ps4">4</div>
    <div class="progress-line" id="pl4"></div>
    <div class="progress-step" id="ps5">âœ“</div>
  </div>

  <!-- ======================== -->
  <!-- STEP 1: ì´ë©”ì¼ ì…ë ¥ -->
  <!-- ======================== -->
  <div class="card" id="step1">
    <div class="card-title">ë³¸ì¸ í™•ì¸</div>
    <div class="card-desc">ì´ë²¤í„°ìŠ¤ì— ë“±ë¡í•˜ì‹  ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. í•´ë‹¹ ì´ë©”ì¼ë¡œ ì¸ì¦ì½”ë“œë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</div>

    <div id="msg1" class="msg msg-error"></div>

    <div class="input-group">
      <label class="input-label">ì´ë²¤í„°ìŠ¤ ë“±ë¡ ì´ë©”ì¼</label>
      <input type="email" class="input-field" id="emailInput" placeholder="example@email.com" autocomplete="email">
    </div>

    <button class="btn btn-primary" id="sendCodeBtn" onclick="sendVerificationCode()">
      <span id="sendCodeText">ì¸ì¦ì½”ë“œ ë°œì†¡</span>
      <div class="spinner hidden" id="sendCodeSpinner"></div>
    </button>
  </div>

  <!-- ======================== -->
  <!-- STEP 2: ì¸ì¦ì½”ë“œ ì…ë ¥ -->
  <!-- ======================== -->
  <div class="card hidden" id="step2">
    <div class="card-title">ì¸ì¦ì½”ë“œ ì…ë ¥</div>
    <div class="card-desc">
      <span id="sentEmailDisplay"></span>ìœ¼ë¡œ ë°œì†¡ëœ 6ìë¦¬ ì¸ì¦ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
    </div>

    <div id="msg2" class="msg msg-error"></div>

    <div class="input-group">
      <label class="input-label">ì¸ì¦ì½”ë“œ</label>
      <input type="text" class="input-field code-input" id="codeInput" placeholder="000000" maxlength="6" inputmode="numeric" pattern="[0-9]*">
    </div>

    <div class="countdown" id="countdown"></div>

    <button class="btn btn-primary" id="verifyBtn" onclick="verifyCode()" style="margin-top: 16px;">
      <span id="verifyText">í™•ì¸</span>
      <div class="spinner hidden" id="verifySpinner"></div>
    </button>

    <button class="btn btn-ghost" id="resendBtn" onclick="resendCode()" style="margin-top: 8px;">ì¸ì¦ì½”ë“œ ì¬ë°œì†¡</button>
  </div>

  <!-- ======================== -->
  <!-- STEP 3: VOD ë°©ì‹ ì„ íƒ -->
  <!-- ======================== -->
  <div class="card hidden" id="step3">
    <div class="card-title">VOD ìˆ˜ì‹  ë°©ì‹ ì„ íƒ</div>
    <div class="card-desc">[í‹°íƒ€ì„ì¦ˆ] ê°œë°œ ëª¨ë¥´ëŠ” ì§ì¥ì¸ì„ ìœ„í•œ 'AIë¡œ ì—…ë¬´ ìë™í™”í•˜ê¸°' ë¼ì´ë¸Œ ì‹¤ìŠµì— í•¨ê»˜í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.<br><br>ê¸°ì¡´ì—ëŠ” êµ¬ê¸€ ë“œë¼ì´ë¸Œë§Œì„ í†µí•´ VODë¥¼ ì œê³µí•´ë“œë ¸ìœ¼ë‚˜, êµ¬ê¸€ ì ‘ì†ì´ ë¶ˆê°€ëŠ¥í•œ í™˜ê²½ì´ë¼ëŠ” ë¶„ë“¤ì´ ê³„ì…”ì„œ êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì˜ìƒ í”Œë ˆì´ì–´ì™€ Vimeo ì¤‘ ì„ íƒí•´ ì‹œì²­í•˜ì‹¤ ìˆ˜ ìˆê²Œ ë„ì™€ë“œë¦¬ê³ ì í•©ë‹ˆë‹¤.<br><br>ë‘˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ ì‚¬ìš©í•˜ê³  ê³„ì‹œëŠ” ê³„ì •ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>

    <div class="option-group" id="vodOptions">
      <div class="option-card" onclick="selectVodMethod('google_drive')">
        <div class="option-radio"></div>
        <span class="option-icon">ğŸ“</span>
        <div class="option-info">
          <h4>Google Drive</h4>
          <p>Google ê³„ì •ìœ¼ë¡œ ê³µìœ  í´ë”ì— ì ‘ê·¼</p>
        </div>
      </div>
      <div class="option-card" onclick="selectVodMethod('vimeo')">
        <div class="option-radio"></div>
        <span class="option-icon">ğŸ¬</span>
        <div class="option-info">
          <h4>Vimeo</h4>
          <p>Vimeo ë¹„ê³µê°œ ì˜ìƒìœ¼ë¡œ ìŠ¤íŠ¸ë¦¬ë°</p>
        </div>
      </div>
    </div>

    <button class="btn btn-primary" id="methodBtn" onclick="goToStep4()" disabled>ë‹¤ìŒ</button>
  </div>

  <!-- ======================== -->
  <!-- STEP 4: ê³„ì • ì…ë ¥ -->
  <!-- ======================== -->
  <div class="card hidden" id="step4">
    <div class="card-title" id="step4Title">ê³„ì • ì •ë³´ ì…ë ¥</div>
    <div class="card-desc" id="step4Desc"></div>

    <div id="msg4" class="msg msg-error"></div>

    <div class="input-group">
      <label class="input-label" id="accountLabel"></label>
      <input type="email" class="input-field" id="accountInput" placeholder="" autocomplete="email">
    </div>

    <button class="btn btn-primary" id="submitBtn" onclick="submitRequest()">
      <span id="submitText">ì‹ ì²­ ì™„ë£Œ</span>
      <div class="spinner hidden" id="submitSpinner"></div>
    </button>

    <button class="btn btn-ghost" onclick="goToStep(3)" style="margin-top: 8px;">â† ì´ì „ìœ¼ë¡œ</button>
  </div>

  <!-- ======================== -->
  <!-- STEP 5: ì™„ë£Œ -->
  <!-- ======================== -->
  <div class="card hidden" id="step5">
    <div class="complete-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
      </svg>
    </div>
    <div class="complete-title">ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</div>
    <div class="complete-desc">ì˜ì—…ì¼ ê¸°ì¤€ 1~2ì¼ ë‚´ì— VOD ì ‘ê·¼ ê¶Œí•œì„ ë³´ë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</div>

    <div class="summary-box">
      <div class="summary-row">
        <span class="summary-label">VOD ìˆ˜ì‹  ë°©ì‹</span>
        <span class="summary-value" id="summaryMethod"></span>
      </div>
      <div class="summary-row">
        <span class="summary-label">í”Œë«í¼ ê³„ì •</span>
        <span class="summary-value" id="summaryAccount"></span>
      </div>
    </div>
  </div>

  <!-- ======================== -->
  <!-- STEP 6: ê¸°ì¡´ ì‹ ì²­ í™•ì¸/ìˆ˜ì • -->
  <!-- ======================== -->
  <div class="card hidden" id="step6">
    <div class="card-title">ê¸°ì¡´ ì‹ ì²­ ë‚´ì—­</div>
    <div class="card-desc">ì´ë¯¸ ì‹ ì²­í•˜ì‹  ë‚´ì—­ì´ ìˆìŠµë‹ˆë‹¤. ìˆ˜ì •í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>

    <div class="summary-box" style="margin-bottom: 24px;">
      <div class="summary-row">
        <span class="summary-label">VOD ìˆ˜ì‹  ë°©ì‹</span>
        <span class="summary-value" id="existingMethod"></span>
      </div>
      <div class="summary-row">
        <span class="summary-label">í”Œë«í¼ ê³„ì •</span>
        <span class="summary-value" id="existingAccount"></span>
      </div>
    </div>

    <button class="btn btn-primary" onclick="goToEditMode()" style="margin-bottom: 10px;">ì‹ ì²­ ì •ë³´ ìˆ˜ì •</button>
    <button class="btn btn-ghost" onclick="deleteRequest()" style="color: #EF4444;">ì‹ ì²­ ì‚­ì œ</button>
  </div>

  <!-- FOOTER -->
  <div class="page-footer">
    ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ê´€ë¦¬ìì—ê²Œ ì—°ë½í•´ì£¼ì„¸ìš”.
  </div>

  <!-- ======================== -->
  <!-- JAVASCRIPT -->
  <!-- ======================== -->
  <script>
    // ============================================================
    // [ì„¤ì •] Supabase ì—°ë™ ì •ë³´ â€” ë°°í¬ ì „ ë°˜ë“œì‹œ ìˆ˜ì •í•˜ì„¸ìš”
    // ============================================================
    const CONFIG = {
      SUPABASE_URL: 'https://YOUR_PROJECT.supabase.co',
      SUPABASE_ANON_KEY: 'YOUR_ANON_KEY',
      // Edge Function ì—”ë“œí¬ì¸íŠ¸
      API: {
        VERIFY_EMAIL: '/functions/v1/verify-email',
        VERIFY_CODE: '/functions/v1/verify-code',
        SUBMIT_REQUEST: '/functions/v1/submit-request',
      }
    };

    // ============================================================
    // State
    // ============================================================
    let state = {
      currentStep: 1,
      email: '',
      vodMethod: '',
      platformAccount: '',
      isEdit: false,
      countdownTimer: null,
      countdownSeconds: 600, // 10ë¶„
    };

    // ============================================================
    // API Helper
    // ============================================================
    async function apiCall(endpoint, body) {
      const url = CONFIG.SUPABASE_URL + endpoint;
      const res = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`,
        },
        body: JSON.stringify(body),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      return data;
    }

    // ============================================================
    // Step Navigation
    // ============================================================
    function goToStep(n) {
      // Hide all steps
      for (let i = 1; i <= 5; i++) {
        document.getElementById(`step${i}`).classList.add('hidden');
      }
      // Show target step
      document.getElementById(`step${n}`).classList.remove('hidden');
      state.currentStep = n;
      updateProgress(n);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function updateProgress(currentStep) {
      for (let i = 1; i <= 5; i++) {
        const ps = document.getElementById(`ps${i}`);
        ps.classList.remove('active', 'done');
        if (i < currentStep) ps.classList.add('done');
        else if (i === currentStep) ps.classList.add('active');
      }
      for (let i = 1; i <= 4; i++) {
        const pl = document.getElementById(`pl${i}`);
        pl.classList.toggle('done', i < currentStep);
      }
    }

    // ============================================================
    // Step 1: ì´ë©”ì¼ ì¸ì¦ì½”ë“œ ë°œì†¡
    // ============================================================
    async function sendVerificationCode() {
      const email = document.getElementById('emailInput').value.trim();
      const msgEl = document.getElementById('msg1');

      // Validation
      if (!email) {
        showMsg(msgEl, 'ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      if (!isValidEmail(email)) {
        showMsg(msgEl, 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      hideMsg(msgEl);
      setLoading('sendCodeBtn', 'sendCodeText', 'sendCodeSpinner', true);

      try {
        await apiCall(CONFIG.API.VERIFY_EMAIL, { email });
        state.email = email;
        document.getElementById('sentEmailDisplay').textContent = email;
        goToStep(2);
        startCountdown();
      } catch (err) {
        showMsg(msgEl, err.message, 'error');
      } finally {
        setLoading('sendCodeBtn', 'sendCodeText', 'sendCodeSpinner', false);
      }
    }

    // ============================================================
    // Step 2: ì¸ì¦ì½”ë“œ í™•ì¸
    // ============================================================
    async function verifyCode() {
      const code = document.getElementById('codeInput').value.trim();
      const msgEl = document.getElementById('msg2');

      if (!code || code.length !== 6) {
        showMsg(msgEl, '6ìë¦¬ ì¸ì¦ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      hideMsg(msgEl);
      setLoading('verifyBtn', 'verifyText', 'verifySpinner', true);

      try {
        await apiCall(CONFIG.API.VERIFY_CODE, { email: state.email, code });
        stopCountdown();

        // ê¸°ì¡´ ì‹ ì²­ ì¡°íšŒ
        const result = await apiCall(CONFIG.API.SUBMIT_REQUEST, { email: state.email, action: 'get' });
        if (result.existing) {
          state.isEdit = true;
          state.vodMethod = result.existing.vod_method;
          state.platformAccount = result.existing.platform_account;
          showExistingRequest(result.existing);
        } else {
          state.isEdit = false;
          goToStep(3);
        }
      } catch (err) {
        showMsg(msgEl, err.message, 'error');
      } finally {
        setLoading('verifyBtn', 'verifyText', 'verifySpinner', false);
      }
    }

    async function resendCode() {
      const msgEl = document.getElementById('msg2');
      hideMsg(msgEl);

      try {
        await apiCall(CONFIG.API.VERIFY_EMAIL, { email: state.email });
        showMsg(msgEl, 'ì¸ì¦ì½”ë“œë¥¼ ì¬ë°œì†¡í–ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'info');
        state.countdownSeconds = 600;
        startCountdown();
      } catch (err) {
        showMsg(msgEl, err.message, 'error');
      }
    }

    // Countdown
    function startCountdown() {
      stopCountdown();
      state.countdownSeconds = 600;
      updateCountdownDisplay();
      state.countdownTimer = setInterval(() => {
        state.countdownSeconds--;
        updateCountdownDisplay();
        if (state.countdownSeconds <= 0) {
          stopCountdown();
          document.getElementById('countdown').textContent = 'ì¸ì¦ì½”ë“œê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¬ë°œì†¡í•´ì£¼ì„¸ìš”.';
        }
      }, 1000);
    }

    function stopCountdown() {
      if (state.countdownTimer) {
        clearInterval(state.countdownTimer);
        state.countdownTimer = null;
      }
    }

    function updateCountdownDisplay() {
      const m = Math.floor(state.countdownSeconds / 60);
      const s = state.countdownSeconds % 60;
      document.getElementById('countdown').textContent = 
        `ì¸ì¦ì½”ë“œ ìœ íš¨ì‹œê°„: ${m}:${String(s).padStart(2, '0')}`;
    }

    // ============================================================
    // Step 3: VOD ë°©ì‹ ì„ íƒ
    // ============================================================
    function selectVodMethod(method) {
      state.vodMethod = method;
      const cards = document.querySelectorAll('#vodOptions .option-card');
      cards.forEach(c => c.classList.remove('selected'));
      
      const idx = method === 'google_drive' ? 0 : 1;
      cards[idx].classList.add('selected');
      document.getElementById('methodBtn').disabled = false;
    }

    function goToStep4() {
      if (!state.vodMethod) return;

      if (state.vodMethod === 'google_drive') {
        document.getElementById('step4Title').textContent = 'Google ê³„ì • ì…ë ¥';
        document.getElementById('step4Desc').textContent = 'VODê°€ ê³µìœ ë  Google ê³„ì • ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        document.getElementById('accountLabel').textContent = 'Google ê³„ì • ì´ë©”ì¼';
        document.getElementById('accountInput').placeholder = 'example@gmail.com';
      } else {
        document.getElementById('step4Title').textContent = 'Vimeo ê³„ì • ì…ë ¥';
        document.getElementById('step4Desc').textContent = 'Vimeoì— ê°€ì…ëœ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        document.getElementById('accountLabel').textContent = 'Vimeo ê°€ì… ì´ë©”ì¼';
        document.getElementById('accountInput').placeholder = 'example@email.com';
      }

      // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ ê¸°ì¡´ê°’ í”„ë¦¬í•„
      if (state.isEdit && state.platformAccount) {
        document.getElementById('accountInput').value = state.platformAccount;
      }

      // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
      document.getElementById('submitText').textContent = state.isEdit ? 'ìˆ˜ì • ì™„ë£Œ' : 'ì‹ ì²­ ì™„ë£Œ';

      goToStep(4);
    }

    // ============================================================
    // Step 4: ì‹ ì²­ ì œì¶œ
    // ============================================================
    async function submitRequest() {
      const account = document.getElementById('accountInput').value.trim();
      const msgEl = document.getElementById('msg4');

      if (!account) {
        showMsg(msgEl, 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      if (!isValidEmail(account)) {
        showMsg(msgEl, 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      hideMsg(msgEl);
      setLoading('submitBtn', 'submitText', 'submitSpinner', true);

      try {
        const result = await apiCall(CONFIG.API.SUBMIT_REQUEST, {
          email: state.email,
          vod_method: state.vodMethod,
          platform_account: account,
        });
        state.platformAccount = account;

        // Summary
        document.getElementById('summaryMethod').textContent = 
          state.vodMethod === 'google_drive' ? 'Google Drive' : 'Vimeo';
        document.getElementById('summaryAccount').textContent = account;

        // ìˆ˜ì •/ì‹ ê·œì— ë”°ë¼ ì™„ë£Œ ë©”ì‹œì§€ ë³€ê²½
        if (state.isEdit) {
          document.querySelector('.complete-title').textContent = 'ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!';
          document.querySelector('.complete-desc').textContent = 'ë³€ê²½ëœ ì •ë³´ë¡œ VOD ì ‘ê·¼ ê¶Œí•œì„ ë‹¤ì‹œ ë³´ë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.';
        } else {
          document.querySelector('.complete-title').textContent = 'ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!';
          document.querySelector('.complete-desc').textContent = 'ì˜ì—…ì¼ ê¸°ì¤€ 1~2ì¼ ë‚´ì— VOD ì ‘ê·¼ ê¶Œí•œì„ ë³´ë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.';
        }

        goToStep(5);
      } catch (err) {
        showMsg(msgEl, err.message, 'error');
      } finally {
        setLoading('submitBtn', 'submitText', 'submitSpinner', false);
      }
    }

    // ============================================================
    // Step 6: ê¸°ì¡´ ì‹ ì²­ í™•ì¸/ìˆ˜ì •/ì‚­ì œ
    // ============================================================
    function showExistingRequest(existing) {
      document.getElementById('existingMethod').textContent = 
        existing.vod_method === 'google_drive' ? 'Google Drive' : 'Vimeo';
      document.getElementById('existingAccount').textContent = existing.platform_account;

      // step6 í‘œì‹œ (progress barëŠ” step2 ì™„ë£Œ ìƒíƒœë¡œ)
      for (let i = 1; i <= 6; i++) {
        const el = document.getElementById(`step${i}`);
        if (el) el.classList.add('hidden');
      }
      document.getElementById('step6').classList.remove('hidden');
      updateProgress(3);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function goToEditMode() {
      // ê¸°ì¡´ ê°’ì„ ë¯¸ë¦¬ ì„ íƒëœ ìƒíƒœë¡œ ì„¸íŒ…í•˜ê³  step3ìœ¼ë¡œ
      state.isEdit = true;
      goToStep(3);
      // ê¸°ì¡´ ì„ íƒê°’ ë°˜ì˜
      if (state.vodMethod) {
        selectVodMethod(state.vodMethod);
      }
    }

    async function deleteRequest() {
      if (!confirm('ì •ë§ ì‹ ì²­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        await apiCall(CONFIG.API.SUBMIT_REQUEST, { email: state.email, action: 'delete' });
        
        document.querySelector('.complete-title').textContent = 'ì‹ ì²­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
        document.querySelector('.complete-desc').textContent = 'ë‹¤ì‹œ ì‹ ì²­í•˜ì‹œë ¤ë©´ í˜ì´ì§€ì— ì¬ì ‘ì†í•´ì£¼ì„¸ìš”.';
        document.getElementById('summaryMethod').textContent = '-';
        document.getElementById('summaryAccount').textContent = '-';
        goToStep(5);
      } catch (err) {
        alert(err.message || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ============================================================
    // Utilities
    // ============================================================
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function showMsg(el, text, type) {
      el.className = `msg msg-${type} show`;
      el.textContent = text;
    }

    function hideMsg(el) {
      el.classList.remove('show');
    }

    function setLoading(btnId, textId, spinnerId, loading) {
      const btn = document.getElementById(btnId);
      const text = document.getElementById(textId);
      const spinner = document.getElementById(spinnerId);
      btn.disabled = loading;
      text.style.display = loading ? 'none' : '';
      spinner.classList.toggle('hidden', !loading);
    }

    // Enter key support
    document.getElementById('emailInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') sendVerificationCode();
    });
    document.getElementById('codeInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') verifyCode();
    });
    document.getElementById('accountInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') submitRequest();
    });

    // Auto-format code input (numbers only)
    document.getElementById('codeInput').addEventListener('input', e => {
      e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 6);
    });
  </script>

</body>
</html>
